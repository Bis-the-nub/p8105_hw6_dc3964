HW6
================
Rene Chi
2025-11-24

## Loading necesscary packages

``` r
library(tidyverse)
library(p8105.datasets)
library(ggplot2)
```

## Problem 1

``` r
# Cleaning data
homicide_df =
  read_csv("hw6 data/homicide-data.csv") |> 
  mutate(
    victim_age = na_if(victim_age, "Unknown"),
    victim_age = as.numeric(victim_age),
    city_state = str_c(city, state, sep = ", ")
  ) |> 
  filter(victim_race == "White" | victim_race == "Black") |> 
  filter(!(city_state == "Dallas, TX" | city_state == "Phoenix, AZ"
           | city_state == "Kansas City, MO" | city_state == "Tulsa, AL"))

# city unsolved case counting
city_summary =
  homicide_df |>
  mutate(
    case_resolved = if_else(disposition == "Closed by arrest",
                            true = 1, false = 0)
  )

# Baltimore glm test
baltimore_summary =
  city_summary |> 
  filter(city_state == "Baltimore, MD")

baltimore_glm_test =
  glm(case_resolved ~ victim_age + victim_race +
        victim_sex, data = baltimore_summary, family = binomial)

# tidy baltimore results
baltimore_result =
  broom::tidy(baltimore_glm_test, exponentiate = TRUE, conf.int = TRUE) |> 
  filter(term == "victim_sexMale") |> 
  select(estimate, conf.low, conf.high)

knitr::kable(baltimore_result)
```

|  estimate |  conf.low | conf.high |
|----------:|----------:|----------:|
| 0.4255117 | 0.3241908 | 0.5575508 |

``` r
# Setting up the function
fit_logistic_model =
  function(df) {
  glm(case_resolved ~ victim_age + victim_race + victim_sex, 
      data = df, 
      family = binomial) |> 
    broom::tidy(exponentiate = TRUE, conf.int = TRUE)
}

# Run the function on all cities
city_results =
  city_summary |>
  nest(data = -city) |> 
  mutate(model_results = map(data, fit_logistic_model)) |> 
  unnest(model_results) |> 
  filter(term == "victim_sexMale") |> 
  select(city, estimate, conf.low, conf.high)

knitr::kable(city_results)
```

| city           |  estimate |  conf.low | conf.high |
|:---------------|----------:|----------:|----------:|
| Albuquerque    | 1.7674995 | 0.8247081 | 3.7618600 |
| Atlanta        | 1.0000771 | 0.6803477 | 1.4582575 |
| Baltimore      | 0.4255117 | 0.3241908 | 0.5575508 |
| Baton Rouge    | 0.3814393 | 0.2043481 | 0.6836343 |
| Birmingham     | 0.8700153 | 0.5713814 | 1.3138409 |
| Boston         | 0.6739912 | 0.3534469 | 1.2768225 |
| Buffalo        | 0.5205704 | 0.2884416 | 0.9358300 |
| Charlotte      | 0.8838976 | 0.5507440 | 1.3905954 |
| Chicago        | 0.4100982 | 0.3361233 | 0.5008546 |
| Cincinnati     | 0.3998277 | 0.2313767 | 0.6670456 |
| Columbus       | 0.5324845 | 0.3770457 | 0.7479124 |
| Denver         | 0.4790620 | 0.2327380 | 0.9624974 |
| Detroit        | 0.5823472 | 0.4619454 | 0.7335458 |
| Durham         | 0.8123514 | 0.3824420 | 1.6580169 |
| Fort Worth     | 0.6689803 | 0.3935128 | 1.1211603 |
| Fresno         | 1.3351647 | 0.5672553 | 3.0475080 |
| Houston        | 0.7110264 | 0.5569844 | 0.9057376 |
| Indianapolis   | 0.9187284 | 0.6784616 | 1.2413059 |
| Jacksonville   | 0.7198144 | 0.5359236 | 0.9650986 |
| Las Vegas      | 0.8373078 | 0.6058830 | 1.1510854 |
| Long Beach     | 0.4102163 | 0.1427304 | 1.0241775 |
| Los Angeles    | 0.6618816 | 0.4565014 | 0.9541036 |
| Louisville     | 0.4905546 | 0.3014879 | 0.7836391 |
| Memphis        | 0.7232194 | 0.5261210 | 0.9835973 |
| Miami          | 0.5152379 | 0.3040214 | 0.8734480 |
| Milwaukee      | 0.7271327 | 0.4951325 | 1.0542297 |
| Minneapolis    | 0.9469587 | 0.4759016 | 1.8809745 |
| Nashville      | 1.0342379 | 0.6807452 | 1.5559966 |
| New Orleans    | 0.5849373 | 0.4218807 | 0.8121787 |
| New York       | 0.2623978 | 0.1327512 | 0.4850117 |
| Oakland        | 0.5630819 | 0.3637421 | 0.8671086 |
| Oklahoma City  | 0.9740747 | 0.6228507 | 1.5199721 |
| Omaha          | 0.3824861 | 0.1988357 | 0.7109316 |
| Philadelphia   | 0.4962756 | 0.3760120 | 0.6498797 |
| Pittsburgh     | 0.4307528 | 0.2626022 | 0.6955518 |
| Richmond       | 1.0060520 | 0.4834671 | 1.9936248 |
| San Antonio    | 0.7046200 | 0.3928179 | 1.2382509 |
| Sacramento     | 0.6688418 | 0.3262733 | 1.3143888 |
| Savannah       | 0.8669817 | 0.4185827 | 1.7802453 |
| San Bernardino | 0.5003444 | 0.1655367 | 1.4623977 |
| San Diego      | 0.4130248 | 0.1913527 | 0.8301847 |
| San Francisco  | 0.6075362 | 0.3116925 | 1.1551470 |
| St.Â Louis      | 0.7031665 | 0.5298505 | 0.9319005 |
| Stockton       | 1.3517273 | 0.6256427 | 2.9941299 |
| Tampa          | 0.8077029 | 0.3395253 | 1.8598834 |
| Tulsa          | 0.9757694 | 0.6090664 | 1.5439356 |
| Washington     | 0.6901713 | 0.4653608 | 1.0122516 |

``` r
# Plot
city_results |>
  mutate(city = fct_reorder(city, estimate)) |>
  ggplot(aes(x = city, y = estimate)) +
  geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
  geom_point() +
  coord_flip() +
  labs(
    title = "Odds Ratio for Solving Homicides \n(Male vs Female Victims)",
    x = "City",
    y = "Estimated Odds Ratio (95% CI)"
  ) +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 8))
```

![](p8105_hw6_dc3964_files/figure-gfm/unnamed-chunk-2-1.png)<!-- -->

According to the plot, Albuquerque city has the highest Odds Ratio with
the widest C.I, while New York City has the lowest Odds Ratio, with
Chicago city having the tightest C.I.
